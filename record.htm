<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>OpenTok First Look</title>
	</head>
	<body>
		<p id="recorderContainer">
		</p>
		<p id="playerContainer">
		</p>
		<style type="text/css">
			.video {
				width: 200px;
				float: left;
				background-color: #333;
			}
		</style>
		<script src="http://staging.tokbox.com/v0.91/js/TB.min.js"></script>
		<script>
			var recorderManager;
			var recorder;
			var player;
			var TOKEN = "moderator_token"; // In production, replace with a token generated by the OpenTok server-side library.
			var API_KEY = "1127";          // Replace with your API key.

			recorderManager = TB.initRecorderManager(API_KEY);

			var recDiv = document.createElement("div");
			var recDivId = "recorder" + new Date().getTime().toString();
			recDiv.setAttribute("id", recDivId);
			document.getElementById("recorderContainer").appendChild(recDiv); // Replace with the ID of the container DOM element.
			recorder = recorderManager.displayRecorder(TOKEN, recDivId);
			recorder.addEventListener("archiveSaved", archiveSavedHandler);

			function archiveSavedHandler(event) {
				alert(event.archives[0].archiveId);
				recorderManager.removeRecorder(recorder);
				loadArchive(event.archives[0].archiveId); // You will want to save the archive ID on your server, for future playback.
			}

			function loadArchive(archiveId) {
				playerDiv = document.createElement("div");
				var playerDivId = "player" + archiveId;
				playerDiv.setAttribute("id", playerDivId);
				document.getElementById("playerContainer").appendChild(playerDiv)
				player = recorderManager.displayPlayer(archiveId, TOKEN, playerDivId);
			}
		</script>
		<div class="video" id="videobox1">
			sdf
		</div>
		<div class="video" id="videobox2">
			sdf
		</div>
		<div class="video" id="videobox3">
			sdf
		</div>
	</body>
</html>
